<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Providing ViewModels to your Screens | Compose Destinations</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://composedestinations.rafaelcosta.xyz/common-use-cases/providing-viewmodels"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Providing ViewModels to your Screens | Compose Destinations"><meta data-react-helmet="true" name="description" content="Getting a ViewModel specific to one Screen"><meta data-react-helmet="true" property="og:description" content="Getting a ViewModel specific to one Screen"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://composedestinations.rafaelcosta.xyz/common-use-cases/providing-viewmodels"><link data-react-helmet="true" rel="alternate" href="https://composedestinations.rafaelcosta.xyz/common-use-cases/providing-viewmodels" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://composedestinations.rafaelcosta.xyz/common-use-cases/providing-viewmodels" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.46c1f5a4.css">
<link rel="preload" href="/assets/js/runtime~main.ceeece0f.js" as="script">
<link rel="preload" href="/assets/js/main.fb3e1e9a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Compose Destinations Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="Compose Destinations Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Compose Destinations</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/raamcosta/compose-destinations" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/setup">Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/defining-destinations">Defining Destinations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/destination-arguments/navigation-arguments">Destination arguments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/navigation/basics">Navigation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/navhosts">Navigation Host Composables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/defining-navgraphs">Defining your Navigation Graphs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/styles-and-animations">Styles and Animations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/deeplinks">Deep links</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/codegenconfigs">Code generation configs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/common-use-cases/bottom-bar-navigation">Common use cases</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/common-use-cases/bottom-bar-navigation">Bottom bar navigation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/common-use-cases/providing-viewmodels">Providing ViewModels to your Screens</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Providing ViewModels to your Screens</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="getting-a-viewmodel-specific-to-one-screen">Getting a ViewModel specific to one Screen<a class="hash-link" href="#getting-a-viewmodel-specific-to-one-screen" title="Direct link to heading">â€‹</a></h2><p>Android Architecture Components ViewModel is a useful class that can easily be tied to a <code>NavBackStackEntry</code>. This means that the state of your screen is live while that screen is in the back stack. If the user goes back to that screen, you don&#x27;t need to do anything extra: the previous state will still be there.</p><p>Even though Compose Destinations will call your annotated Composables with a limited set of components it can provide out the box (read about them <a href="/destination-arguments/navhost-level-parameters">here</a>), there are a few ways you can get the ViewModel.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>In these next examples, I&#x27;ll be using <code>hiltViewModel()</code> function to get the ViewModel.
If you&#x27;re not using Hilt, then check the <a href="#make-your-one-liner-viewmodel-getter">last section of this page</a> for a way to make your own one-liner function to replace <code>hiltViewModel()</code> with.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-default-parameters-feature">Using default parameters feature<a class="hash-link" href="#using-default-parameters-feature" title="Direct link to heading">â€‹</a></h3><p>This is probably the most simple approach if you have a simple function you can call in a Composable scope to get a ViewModel.</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MyScreen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    viewModel: MyScreenViewModel = hiltViewModel()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) { /*...*/ }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-a-setup-composable">Using a setup Composable<a class="hash-link" href="#using-a-setup-composable" title="Direct link to heading">â€‹</a></h3><p>A setup Composable is a place to get all state and &quot;event handlers&quot; and then call the Composable that will compose the actual screen content which can then just receive state and lambdas.</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MyScreen() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val viewModel: MyScreenViewModel = hiltViewModel()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MyScreenContent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isButtonEnabled = viewModel.isButtonEnabled, // example of state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        onButtonClick = viewModel::onButtonClicked // example of events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MyScreenContent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isButtonEnabled: Boolean,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    onButtonClick: () -&gt; Unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) { /*...*/ }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you&#x27;re used to Jetpack Compose navigation, think of this method as you would think about the setup code you would do inside <code>NavGraphBuilder</code>. With Compose Destinations, whatever you&#x27;d do there, you can do in this &quot;setup&quot; Composable.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Notice how your &quot;Content&quot; is a &quot;pure&quot; Composable. It only takes stuff that doesn&#x27;t depend on the platform, it could even be part of a module shared in Kotlin Multiplatform.<br>
<!-- -->Of course, you can accomplish the same thing with any of the other approaches.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-dependenciescontainerbuilder">Using <code>dependenciesContainerBuilder</code><a class="hash-link" href="#using-dependenciescontainerbuilder" title="Direct link to heading">â€‹</a></h3><p>Even though this method is usually more appropriate to prepare dependencies which will be used by multiple/all screens, you can still use it for this case:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DestinationsNavHost(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dependenciesContainerBuilder = { //this: DependenciesContainerBuilder&lt;*&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (destination is MyScreenDestination) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dependency(hiltViewModel&lt;MyScreenViewModel&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you&#x27;re using the <a href="/codegenconfigs#multi-module-configs">default &quot;singlemodule&quot; mode</a>, then there is a generated <code>sealed Destination</code> and you can switch the above <code>if(destination is ...</code> with a <code>when(destination as Destination)</code> and that will force you to come here and add a new entry when you add new ViewModels.</p></div></div><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MyScreen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    viewModel: MyScreenViewModel // &lt;-- this will be provided by the lib through the `dependenciesContainerBuilder`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="manually-calling-your-screen-composable">Manually calling your screen Composable<a class="hash-link" href="#manually-calling-your-screen-composable" title="Direct link to heading">â€‹</a></h3><p>This is the closest way to how you&#x27;d do it with Jetpack Compose Navigation. But with Compose Destinations the only thing you&#x27;re doing is calling the Composable. No navigation arguments or navigation graphs declaration done in the same place:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DestinationsNavHost(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    composable(MyScreenDestination) { //this: DestinationScope&lt;MyScreenDestination.NavArgs&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MyScreen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            viewModel = hiltViewModel()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Contrary to if you were using Jetpack Compose Navigation, you are not building the navigation graph here (that information comes through the <code>navGraph</code> parameter). So you don&#x27;t need to do this for all your screens, just the ones that need some parameters that the library cannot provide.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="share-viewmodels-between-multiple-destinations">Share ViewModels between multiple destinations<a class="hash-link" href="#share-viewmodels-between-multiple-destinations" title="Direct link to heading">â€‹</a></h2><p>If you want to share a ViewModel with multiple destinations, you need to choose a scope that lives longer than a specific screen. Usually that will be either a nested navigation graph if you want to share a ViewModel with all destinations that belong to that nested nav graph, or an Activity if you want to share a ViewModel with all your destinations.</p><p>Either way, in this case, the simplest option (even though the above ones can also work) is to use <code>dependenciesContainerBuilder</code> of <code>DestinationsNavHost</code> function.
Here is what that looks like:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun AppNavigation(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activity: Activity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DestinationsNavHost(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dependenciesContainerBuilder = { //this: DependenciesContainerBuilder&lt;*&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // To tie SettingsViewModel to &quot;settings&quot; nested navigation graph, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // making it available to all screens that belong to it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (NavGraphs.settings.contains(destination)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                val parentEntry = remember { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    navController.getBackStackEntry(NavGraphs.settings.route) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dependency(hiltViewModel&lt;SettingsViewModel&gt;(parentEntry))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // To tie ActivityViewModel to the activity, making it available to all destinations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dependency(hiltViewModel&lt;ActivityViewModel&gt;(activity))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then a screen that belongs to &quot;settings&quot; navigation graph could just do:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Destination(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    navGraph = &quot;settings&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun MainSettingsScreen(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    settingsViewModel: SettingsViewModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As well as all Destinations can also declare a <code>activityViewModel: ActivityViewModel</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The example uses <code>hiltViewModel</code>, but check the next sections if you don&#x27;t use Hilt.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="make-your-one-liner-viewmodel-getter">Make your one liner ViewModel getter<a class="hash-link" href="#make-your-one-liner-viewmodel-getter" title="Direct link to heading">â€‹</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>This section is not directly related to Compose Destinations. This would be true and valid even if you were not using Compose Destinations library.<br>
<!-- -->I just felt like this could be helpful as I have seen some confusion around getting a ViewModel tied to the navigation destination.</p></div></div><p>In previous examples, I used the most simple way of getting a view model instance, and that is with <code>hiltViewModel()</code> which belongs to Hilt Dependency Injection framework.</p><p>I&#x27;ve seen some confusion in the community where some people believe that you need Hilt to get a ViewModel that is tied to a <code>NavBackStackEntry</code>. That is not true at all. The only thing Hilt facilitates is injecting dependencies to that ViewModel at the same time. But with some manual setup, you can make your function.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="manual-or-no-dependency-injection">Manual or no dependency injection<a class="hash-link" href="#manual-or-no-dependency-injection" title="Direct link to heading">â€‹</a></h3><p>If you&#x27;re manually setting up dependency injection in your code or you simply are not using dependency injection, you can do this:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@Composable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inline fun &lt;reified VM : ViewModel&gt; viewModel(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    viewModelStoreOwner: ViewModelStoreOwner = checkNotNull(LocalViewModelStoreOwner.current) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;No ViewModelStoreOwner was provided via LocalViewModelStoreOwner&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    savedStateRegistryOwner: SavedStateRegistryOwner = LocalSavedStateRegistryOwner.current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">): VM {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return androidx.lifecycle.viewmodel.compose.viewModel(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        viewModelStoreOwner = viewModelStoreOwner,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory = ViewModelFactory(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            owner = savedStateRegistryOwner,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            defaultArgs = (savedStateRegistryOwner as? NavBackStackEntry)?.arguments,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             //remove this line if you&#x27;re not using Dependency injection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dependencyContainer = [ACCESS YOUR DEPENDENCIES GRAPH HERE SOMEHOW],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ViewModelFactory(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner: SavedStateRegistryOwner,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defaultArgs: Bundle?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //remove this line if you&#x27;re not using Dependency injection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val dependencyContainer: DependencyContainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) : AbstractSavedStateViewModelFactory(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defaultArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Suppress(&quot;UNCHECKED_CAST&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun &lt;T : ViewModel?&gt; create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        key: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelClass: Class&lt;T&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handle: SavedStateHandle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ): T {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return when (modelClass) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ProfileViewModel::class.java -&gt; ProfileViewModel(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dependencyContainer.getProfileLikeCountUseCase,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ProfileScreenDestination.argsFrom(handle)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GreetingViewModel::class.java -&gt; GreetingViewModel()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else -&gt; throw RuntimeException(&quot;Unknown view model $modelClass&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } as T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As seen above, if you want a single function for all viewModel types, then you need a single <code>ViewModelFactory</code> that can create all your types of ViewModels. Alternatively, you could have one function for each ViewModel (example: <code>profileViewModel()</code> to get <code>ProfileViewModel</code> by using a <code>ProfileViewModelFactory</code>).</p><p>This does mean that every time you add a new ViewModel to your code base, you&#x27;ll have to come here and add that entry to the <code>when</code> statement above. Nothing is perfect, and this is definitely one reason to make you want to use a Dependency Injection framework like Hilt, so that this is handled for you.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>&quot;<!-- -->[ACCESS YOUR DEPENDENCIES GRAPH HERE SOMEHOW]<!-- -->&quot;</h5></div><div class="admonition-content"><p>If you&#x27;re using manual Dependency injection, you must treat this function as you do with accessing your dependencies graph in an Android entry point (Activity, Fragment, etc), i.e, you need to directly access it somehow.<br>
<!-- -->There are plenty of ways to do this depending on where you&#x27;re saving the dependencies container instance: you could use <a href="https://developer.android.com/jetpack/compose/compositionlocal" target="_blank" rel="noopener noreferrer">CompositionLocals</a> feature to provide the container, you could access your singleton <code>Application</code> instance if you&#x27;re dependencies are available there, or you could do <a href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:hilt/hilt-navigation/src/main/java/androidx/hilt/navigation/HiltNavBackStackEntry.kt" target="_blank" rel="noopener noreferrer">what Hilt does internally</a> which is take the <code>LocalContext.current</code> and try to get an Activity from that, then you can get the dependency container declared in that Activity.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="other-di-frameworks">Other DI frameworks<a class="hash-link" href="#other-di-frameworks" title="Direct link to heading">â€‹</a></h3><p>If you&#x27;re using a DI framework other than Hilt (Koin, f.e) then you need to check that framework&#x27;s documentation in how you can get an instance of a ViewModel.</p><p>Remember that if in your framework you have to explicitly pass something like <code>NavBackStackEntry</code>, <code>ViewModelStoreOwner</code> or <code>SavedStateRegistryOwner</code> then check the above example to see how to get that. You can use them to make your own wrapper calling the framework method.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/raamcosta/compose-destinations-docs/edit/main/docusaurus/docs/common-use-cases/providing-viewmodels.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/common-use-cases/bottom-bar-navigation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Bottom bar navigation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-a-viewmodel-specific-to-one-screen" class="table-of-contents__link toc-highlight">Getting a ViewModel specific to one Screen</a><ul><li><a href="#using-default-parameters-feature" class="table-of-contents__link toc-highlight">Using default parameters feature</a></li><li><a href="#using-a-setup-composable" class="table-of-contents__link toc-highlight">Using a setup Composable</a></li><li><a href="#using-dependenciescontainerbuilder" class="table-of-contents__link toc-highlight">Using <code>dependenciesContainerBuilder</code></a></li><li><a href="#manually-calling-your-screen-composable" class="table-of-contents__link toc-highlight">Manually calling your screen Composable</a></li></ul></li><li><a href="#share-viewmodels-between-multiple-destinations" class="table-of-contents__link toc-highlight">Share ViewModels between multiple destinations</a></li><li><a href="#make-your-one-liner-viewmodel-getter" class="table-of-contents__link toc-highlight">Make your one liner ViewModel getter</a><ul><li><a href="#manual-or-no-dependency-injection" class="table-of-contents__link toc-highlight">Manual or no dependency injection</a></li><li><a href="#other-di-frameworks" class="table-of-contents__link toc-highlight">Other DI frameworks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Compose Destinations, Rafael Costa. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ceeece0f.js"></script>
<script src="/assets/js/main.fb3e1e9a.js"></script>
</body>
</html>